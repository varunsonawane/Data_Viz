<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Total Auction Spending by Team (2013–2024)</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
    }
    #chart {
      position: relative;
      width: 960px;
      height: 600px;
      margin: 20px auto;
    }
    .node {
      cursor: pointer;
    }
    .node rect {
      stroke: #fff;
    }
    .node text {
      font-size: 12px;
      pointer-events: none;
    }
    .tooltip {
      position: absolute;
      text-align: left;
      padding: 8px;
      font: 14px Rockwell, serif;
      background: white;
      border: 1px solid #ccc;
      border-radius: 4px;
      pointer-events: none;
      opacity: 0;
    }
    h1 {
      text-align: center;
      font-family: sans-serif;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Total Auction Spending by Team (2013–2024)</h1>
  <div id="chart"></div>
  <div class="tooltip"></div>
  <script>
  const width = 960;
  const height = 600;

  const svg = d3.select("#chart")
    .append("svg")
      .attr("width", width)
      .attr("height", height);

  const tooltip = d3.select(".tooltip");

  // Load and process data
  d3.csv("archive/IPLPlayerAuctionData.csv", d => ({
    Team: d.Team,
    Year: d.Year === "" ? null : +d.Year,
    Amount: +d.Amount
  })).then(raw => {
    // filter out missing years
    const data = raw.filter(d => d.Year !== null);

    // roll up by Team → sum Amount
    const rollup = Array.from(
      d3.rollup(
        data,
        v => d3.sum(v, d => d.Amount),
        d => d.Team
      ),
      ([Team, value]) => ({ Team, value })
    );

    // build a root with children = our rollup array
    const root = d3.hierarchy({ children: rollup })
      .sum(d => d.value)
      .sort((a,b) => b.value - a.value);

    // create treemap layout
    d3.treemap()
      .size([width, height])
      .paddingInner(1)
      (root);

    // color scale: Blues
    const maxVal = d3.max(rollup, d => d.value);
    const color = d3.scaleSequential(d3.interpolateBlues)
      .domain([0, maxVal]);

    // draw each leaf node
    const node = svg.selectAll("g")
      .data(root.leaves())
      .enter().append("g")
        .attr("class", "node")
        .attr("transform", d => `translate(${d.x0},${d.y0})`)
        .on("mousemove", (event, d) => {
          tooltip
            .style("left", (event.pageX + 10) + "px")
            .style("top",  (event.pageY - 28) + "px")
            .html(
              `<strong>Team:</strong> ${d.data.Team}<br/>
               <strong>Amount:</strong> ₹${d.value.toLocaleString()}`
            )
            .transition().duration(200).style("opacity", 0.9);
        })
        .on("mouseout", () => {
          tooltip.transition().duration(300).style("opacity", 0);
        });

    node.append("rect")
        .attr("width", d => d.x1 - d.x0)
        .attr("height", d => d.y1 - d.y0)
        .attr("fill", d => color(d.value));

    node.append("text")
        .attr("x", 4)
        .attr("y", 14)
        .text(d => d.data.Team)
        .each(function(d) {
          const rectWidth = d.x1 - d.x0;
          // truncate text if too long
          let txt = d3.select(this),
              full = txt.text();
          while (txt.node().getComputedTextLength() > rectWidth - 8) {
            full = full.slice(0, -1);
            txt.text(full + "…");
          }
        });
  });
  </script>
</body>
</html>
